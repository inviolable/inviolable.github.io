<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebRTC 화상 통화</title>
</head>
<body>
  <video id="localVideo"></video>
  <video id="remoteVideo"></video>
  <button id="startButton">통화 시작</button>
  <script src="https://webrtc.org/dist/webrtc.js"></script>
  <script>
    const localVideo = document.getElementById("localVideo");
    const remoteVideo = document.getElementById("remoteVideo");
    const startButton = document.getElementById("startButton");

    let peerConnection;

    startButton.addEventListener("click", async () => {
      // 사용자 미디어 접근
      const stream = await navigator.mediaDevices.getUserMedia({
        video: true,
        audio: true,
      });
	
     console.log("허용됨");
      // 로컬 비디오 출력
      localVideo.srcObject = stream;
        localVideo.play();

      // PeerConnection 생성
     const peerConnection = new RTCPeerConnection({
          iceServers: [
            {
              urls: 'stun:stun.l.google.com:19302',
            },
          ],
});

      // ICE 서버 설정
      peerConnection.onicecandidate = (event) => {
        if (event.candidate) {
          // 서버에 후보 정보 전송
        }
      };

      // SDP 세션 생성
      const offer = await peerConnection.createOffer();
      await peerConnection.setLocalDescription(offer);

      // 서버에 SDP 정보 전송

      // 상대방 SDP 정보 수신 및 처리
      peerConnection.onaddstream = (event) => {
        // 원격 비디오 출력
        remoteVideo.srcObject = event.stream;
        remoteVideo.play();
      };

      // 연결 종료 처리
      peerConnection.oniceconnectionstatechange = () => {
        if (peerConnection.iceConnectionState === "disconnected") {
          // 연결 종료
        }
      };
    });
  </script>
</body>
</html>